<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>注册</title>

    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="http://lib.sinaapp.com/js/jquery/2.0.2/jquery-2.0.2.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
</head>
<body>
<div class="container">
    <div class="row">
        <div class="col-md-2"></div>
        <div class="col-md-8" style="margin-top: 3%">
            <form action="/register/registerUser" id="register_form" method="post">
                <div class="form-group">
                    <label for="Username">用户名</label>
                    <input maxlength="25" minlength="5" v-model="username" pattern="^[\u4e00-\u9fa5a-zA-Z][\u4e00-\u9fa5_a-zA-Z0-9]*$" class="form-control" id="Username" name="Username" aria-describedby="UsernameHelp" placeholder="请输入用户名" onblur="verficationUsername()">
                    <small id="UsernameHelp" class="form-text text-muted">用户名只能包含汉字英文数字和下划线，开头不能以数字和下划线开始</small>
                </div>
                <label for="Password">密码</label>
                <div class="input-group">
                    <input maxlength="64" minlength="6" v-model="password" type="password" class="form-control" id="Password" name="Password" placeholder="请输入密码" required>
                    <div class="input-group-append">
                        <button class="btn btn-outline-secondary" type="button" id="show_passwd" onmousedown="mw()" onmouseleave="jm()">按住显示密码</button>
                    </div>
                </div>

                <label for="Telephone">手机号</label>
                <div class="input-group">

                    <input v-model="telephone" pattern="^[1]([3-9])[0-9]{9}$" id="Telephone" name="Telephone" class="form-control" placeholder="请输入手机号" aria-label="请输入手机号" aria-describedby="button-addon2" required>
                    <div class="input-group-append">
                        <button class="btn btn-outline-secondary" type="button" id="button-addon2" onclick="getCode()">获取验证码</button>
                    </div>

                </div>
                <div class="form-group">
                    <small id="TelephoneHelp" class="form-text text-muted">我们不会将您的手机号泄露</small>
                </div>
                <div class="form-group">
                    <label for="code">验证码</label>
                    <input v-model="verification" type="text" class="form-control" id="code" name="code" placeholder="请输入验证码" required>
                </div>
                <div class="form-group">
                    <label for="Email">邮箱</label>
                    <input v-model="email" maxlength="255" type="email" class="form-control" id="Email" name="Email" aria-describedby="emailHelp" placeholder="请输入邮箱" required>
                    <small id="emailHelp" class="form-text text-muted">我们不会将您的邮箱泄露</small>
                </div>



                <div class="form-group">
                    <label for="IdCard">身份证号</label>
                    <input v-model="idCard" pattern="^(\d{18,18}|\d{15,15}|(\d{17,17}[x|X]))$" class="form-control" id="IdCard" name="IdCard" aria-describedby="IdCardHelp" placeholder="请输入身份证号" required>
                    <small id="IdCardHelp" class="form-text text-muted">我们不会将您的身份证号泄露</small>
                </div>

                <div class="form-group" >
                    <label for="Gender">您的性别</label>
                    <select v-model="gender" class="form-control" id="Gender" required>
                        <option>male</option>
                        <option>female</option>
                        <option>unknown</option>
                    </select>
                </div>

                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="inputGroupFileAddon01">头像选择</span>
                    </div>
                    <div class="custom-file">
                        <input v-model="smfile" type="file" accept="image/*" class="custom-file-input" id="Smfile" name="avatar" aria-describedby="inputGroupFileAddon01" required>
                        <label class="custom-file-label" for="Smfile">Choose file</label>
                    </div>
                    <div>
                        <button type="button" class="btn btn-info" onclick="upload()">上传</button>
                        <img id="test_img" src="" class="img-thumbnail">
                    </div>
                </div>

                <button type="submit" class="btn btn-primary" onclick="test()">确认注册</button>
            </form>
        </div>
        <div class="col-md-2"></div>
    </div>
</div>
</body>
</html>

<script>
    var user = new Vue({
        el:"#register_form",
        data:{
            telephone:"",
            username:"",
            password:"",
            verification:"",
            email:"",
            idCard:"",
            gender:"",
            smfile:""
        }
    });
    function getCode() {
        var j = {"telephone":user.telephone};
        if (verificationTelephone()){
            url = "/verification/sendCode";
            $.post(url,j,function (json) {
                console.log(json.status)
            });
            timer(60);
        }
        else{
            console.log("手机号不正确")
        }
    }
    function verificationTelephone() {
        var telephone = user.telephone;
        var pattern = /^[1]([3-9])[0-9]{9}$/;
        if (!pattern.exec(telephone)) {   //判断
            return false;
        }
        else {
            return true;
        }
    }
    function verficationUsername(){
        var username = user.username;
        var pattern = /^[\u4e00-\u9fa5a-zA-Z][\u4e00-\u9fa5_a-zA-Z0-9]*$/;
        if (!pattern.exec(username)) {   //判断
            return false;
        }
        else {
            return true;
        }
    }
    function verficationIdCard(){
        var idCard = user.idCard;
        var pattern = /^(\d{18,18}|\d{15,15}|(\d{17,17}[x|X]))$/;
        if (!pattern.exec(idCard)) {   //判断
            return false;
        }
        else {
            return true;
        }
    }
    function timer(time) {
        var btn = $("#button-addon2");
        btn.attr("disabled", true);  //按钮禁止点击
        btn.text(time <= 0 ? "发送验证码" : ("" + (time) + "秒后可发送"));
        var hander = setInterval(function() {
            if (time <= 0) {
                clearInterval(hander); //清除倒计时
                btn.text("发送验证码");
                btn.attr("disabled", false);
                return false;
            }else {
                btn.text("" + (time--) + "秒后可发送");
            }
        }, 1000);
    }
    function mw() {
        console.log("mw");
        $("#Password").attr("type","text");
    }
    function jm() {
        console.log("jm");
        $("#Password").attr("type","password");
    }

    function upload() {
        var file=$('#Smfile')[0].files[0];
        if(file.size>500*1024){
            alert('您选择的图片太大，不能上传！');
            return;
        }
        var j=new FormData();
        j.append('smfile',file);
        var url='https://sm.ms/api/upload';
        $.ajax(
            {
                type:'POST',
                url:url,
                data:j,
                cache: false,
                processData: false,
                contentType: false,
                success:function(json){
                    user.smfile = json.data.url;
                    console.log(user.smfile);
                    document.getElementById("test_img").src=json.data.url;
                }
            }
        );
    }
</script>